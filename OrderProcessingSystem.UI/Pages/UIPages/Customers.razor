@page "/customers"
@using OrderProcessingSystem.UI.Shared.UIViewModels
@inject OrderProcessingSystem.Contracts.Interfaces.IViewModelDataProvider ViewModelDataProvider
@inject Microsoft.JSInterop.IJSRuntime JSRuntime
@inherits BaseDataPage<CustomerWithOrdersVM>
<link rel="stylesheet" href="~/css/customers.css" />

<BaseDataPage TItem="CustomerWithOrdersVM" 
              PageTitle="Customers"
              EntityName="customers"
              ShowCardsText="Show Cards"
              ShowGridText="All Customers"
              GridPageSize="10"
              CardPageSize="12"
              CardColumnClass="col-12 col-sm-6 col-md-4 col-xl-3 mb-3"
              DataLoader="@LoadCustomersAsync">
    <CardTemplate Context="customer">
        <div class="card p-3 card-content">
            <h5 class="text-truncate">@customer.Name</h5>
            <p class="small text-muted">Orders: @customer.OrdersCount</p>
            <p class="small">Sales Total: <strong>@customer.TotalSales.ToTwoDecimals(true)</strong></p>
        </div>
    </CardTemplate>
</BaseDataPage>

@code {
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }

    // Data loader function for customers - now uses centralized ViewModelDataProvider
    private async Task<List<CustomerWithOrdersVM>?> LoadCustomersAsync()
    {
        return await ViewModelDataProvider.GetCustomersWithOrdersAsync<CustomerWithOrdersVM>();
    }
}
