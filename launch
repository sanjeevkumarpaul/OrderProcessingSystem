#!/bin/bash
# Universal Cross-Platform Launcher for OrderProcessingSystem
# File: launch
# Works on: Windows (Git Bash/WSL), macOS, Linux

echo "üåç OrderProcessingSystem - Universal Cross-Platform Launcher"

# Get the action from parameter or default to start
action="${1:-start}"

# Handle short flags and long parameters
case "$action" in
    "--s"|"--start") action="start" ;;
    "--x"|"--stop")  action="stop" ;;
    "--q"|"--qstart"|"--quick") action="qstart" ;;
    "--help"|"-h") 
        echo ""
        echo "üìñ Usage:"
        echo "  ./launch [--s|--start|start]     Start with build validation"
        echo "  ./launch [--q|--qstart|qstart]   Quick start (no build validation)"
        echo "  ./launch [--x|--stop|stop]       Stop all services"
        echo ""
        echo "üîó Short Keys:"
        echo "  --s   Start with build validation"
        echo "  --q   Quick start"
        echo "  --x   Stop all services"
        echo ""
        echo "üñ•Ô∏è Platform Usage:"
        echo "  macOS/Linux: ./launch --s"
        echo "  Windows:     bash launch --s  (or just 'launch --s' in Git Bash)"
        exit 0
        ;;
esac

echo ""
echo "üéØ Action: $action"
echo ""

# Detect operating system
OS=$(uname -s)
case "$OS" in
    MINGW*|MSYS*|CYGWIN*)
        echo "ü™ü Detected: Windows (Git Bash/MSYS)"
        echo "üìÇ Using WINOS folder for Windows system..."
        
        if [ ! -d "WINOS" ]; then
            echo "‚ùå Error: WINOS folder not found!"
            exit 1
        fi
        
        case "$action" in
            "start")
                echo "‚ñ∂Ô∏è  Executing: WINOS/start.ps1"
                powershell.exe -ExecutionPolicy Bypass -File "WINOS/start.ps1"
                ;;
            "stop")
                echo "‚ñ∂Ô∏è  Executing: WINOS/stop.ps1"
                powershell.exe -ExecutionPolicy Bypass -File "WINOS/stop.ps1"
                ;;
            "qstart")
                echo "‚ö° Quick start mode"
                echo "‚ñ∂Ô∏è  Executing: WINOS/start.ps1"
                powershell.exe -ExecutionPolicy Bypass -File "WINOS/start.ps1"
                ;;
            *)
                echo "‚ùå Error: Unknown action '$action'"
                exit 1
                ;;
        esac
        ;;
    "Darwin"|"Linux"|*"BSD")
        echo "üçé Detected: macOS/Unix-like system"
        echo "üìÇ Using MACOS folder for Unix-like system..."
        
        if [ ! -d "MACOS" ]; then
            echo "‚ùå Error: MACOS folder not found!"
            exit 1
        fi
        
        chmod +x MACOS/*.sh 2>/dev/null || true
        
        case "$action" in
            "start")
                echo "‚ñ∂Ô∏è  Executing: ./MACOS/start.sh"
                ./MACOS/start.sh
                ;;
            "stop")
                echo "‚ñ∂Ô∏è  Executing: ./MACOS/stop.sh"
                ./MACOS/stop.sh
                ;;
            "qstart")
                echo "‚ö° Quick start mode (Unix-like only)"
                echo "‚ñ∂Ô∏è  Executing: ./MACOS/qstart.sh"
                ./MACOS/qstart.sh
                ;;
            *)
                echo "‚ùå Error: Unknown action '$action'"
                exit 1
                ;;
        esac
        ;;
    *)
        echo "‚ùå Error: Unsupported operating system: $OS"
        exit 1
        ;;
esac

echo ""
echo "‚úÖ Command completed successfully!"
